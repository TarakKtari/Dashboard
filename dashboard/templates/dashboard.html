<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('dashboard_bp.static', filename='css/dashboard.css') }}">
</head>
<body>
    <div class="dashboard-container">
        <h1>FX Trading Dashboard â€“ Admin View</h1>
        <div class="dashboard-row">
            <div class="dashboard-card">
                <h3>Last Fixing</h3>
                <div id="last-fixing">
                    <!-- Populated by JS or backend -->
                </div>
            </div>
            <div class="dashboard-card">
                <h3>Live Fixing</h3>
                <div id="live-fixing">
                    <!-- Populated by JS or backend -->
                </div>
            </div>
            <div class="dashboard-card">
                <h3>Adjusted Rate</h3>
                <div id="adjusted-rate">
                    <!-- Populated by JS or backend -->
                </div>
            </div>
        </div>
        <div class="dashboard-row">
            <div class="dashboard-card dashboard-chart">
                <h3>DXY (US Dollar Index)</h3>
                <canvas id="dxyChart" width="400" height="300"></canvas>
            </div>
            <div class="dashboard-card dashboard-chart">
                <h3>VIX (CBOE Volatility Index)</h3>
                <canvas id="vixChart" width="400" height="300"></canvas>
            </div>
            <div class="dashboard-card dashboard-chart">
                <h3>USD/EUR</h3>
                <canvas id="usdeurChart" width="400" height="300"></canvas>
            </div>
        </div>
    </div>
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('dashboard_bp.static', filename='js/dashboard.js') }}"></script>
    
    <script>
    // Wait for DOM and Chart.js to load
    document.addEventListener('DOMContentLoaded', function() {
        // Parse data passed from Flask
        try {
            const dxyData = {{ dxy_data|tojson }};
            const vixData = {{ vix_data|tojson }};
            const usdeurData = {{ usdeur_data|tojson }};
            
            console.log('DXY Data:', dxyData);
            console.log('VIX Data:', vixData);
            console.log('USD/EUR Data:', usdeurData);

            // DXY Chart
            const dxyLabels = Array.isArray(dxyData) ? dxyData.map(item => item.Datetime) : [];
            const dxyValues = Array.isArray(dxyData) ? dxyData.map(item => item.Close) : [];
            if (dxyLabels.length && dxyValues.length) {
                const dxyCtx = document.getElementById('dxyChart').getContext('2d');
                new Chart(dxyCtx, {
                    type: 'line',
                    data: {
                        labels: dxyLabels,
                        datasets: [{
                            label: 'DXY',
                            data: dxyValues,
                            borderColor: 'blue',
                            backgroundColor: 'rgba(0, 0, 255, 0.1)',
                            fill: false
                        }]
                    },
                    options: {responsive: true, maintainAspectRatio: false}
                });
            }

            // VIX Chart
            const vixLabels = Array.isArray(vixData) ? vixData.map(item => item.Datetime) : [];
            const vixValues = Array.isArray(vixData) ? vixData.map(item => item.Close) : [];            if (vixLabels.length && vixValues.length) {
                const vixCtx = document.getElementById('vixChart').getContext('2d');
                new Chart(vixCtx, {
                    type: 'line',
                    data: {
                        labels: vixLabels,
                        datasets: [{
                            label: 'VIX',
                            data: vixValues,
                            borderColor: 'red',
                            backgroundColor: 'rgba(255, 0, 0, 0.1)',
                            fill: false
                        }]
                    },
                    options: {responsive: true, maintainAspectRatio: false}
                });
            }

            // USD/EUR Chart
            const usdeurLabels = Array.isArray(usdeurData) ? usdeurData.map(item => item.Datetime) : [];
            const usdeurValues = Array.isArray(usdeurData) ? usdeurData.map(item => item.Close) : [];
            if (usdeurLabels.length && usdeurValues.length) {
                const usdeurCtx = document.getElementById('usdeurChart').getContext('2d');
                new Chart(usdeurCtx, {
                    type: 'line',
                    data: {
                        labels: usdeurLabels,
                        datasets: [{
                            label: 'USD/EUR',
                            data: usdeurValues,
                            borderColor: 'green',
                            backgroundColor: 'rgba(0, 255, 0, 0.1)',
                            fill: false
                        }]
                    },
                    options: {responsive: true, maintainAspectRatio: false}
                });
            }
        } catch (error) {
            console.error('Error rendering charts:', error);
        }
    });
    </script>
</body>
</html>
